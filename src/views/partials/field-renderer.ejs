<% 
// Import view helpers for consistent rendering
const { TemplateUtils, FieldUtils, ContentUtils } = require('../../src/utils/view-helpers');

function renderField(field, prepopulateData = {}, fromWizard = false) {
  if (field.type === 'multi-select-criteria' || field.optional) {
    return ''; // Handle these separately
  }

  const prepopVal = prepopulateData[field.name] || '';
  const defaultVal = prepopVal || field.defaultValue || '';
  const showWizardHint = prepopVal && fromWizard;
  const fieldAttribs = TemplateUtils.getFieldAttributes(field);
  fieldAttribs.value = defaultVal;

  // Handle special number field defaults
  if (field.type === 'number' && (field.name === 'approaches' || field.name === 'versions')) {
    fieldAttribs.value = defaultVal || '3';
    fieldAttribs.min = '1';
    fieldAttribs.max = '5';
  }

  const labelHint = showWizardHint 
    ? `<small class="wizard-hint"><i class='bx bx-check-circle'></i> Pre-filled from wizard</small>`
    : (defaultVal && field.type !== 'number') 
      ? `<small class="default-hint">(using default)</small>` 
      : '';

  const inputElement = field.type === 'textarea' 
    ? `<textarea ${TemplateUtils.attributesToString(fieldAttribs)}>${defaultVal}</textarea>`
    : `<input ${TemplateUtils.attributesToString(fieldAttribs)}>`;

  return `
    <div class="form-group">
      <label for="${field.name}">
        ${field.label}${field.required ? ' *' : ''}
        ${labelHint}
      </label>
      ${inputElement}
    </div>
  `;
}
%>

<div class="form-group">
  <%- renderField(field, prepopulateData, fromWizard) %>
</div>