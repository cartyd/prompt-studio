<div>
  <div class="info-box mb-md">
    <pre id="prompt-text" class="pre-wrap"><%= promptText %></pre>
  </div>
  <button type="button" 
          id="copy-prompt-btn" 
          class="copy-btn"
          class="flex-center mb-md">
    <span id="copy-icon">ðŸ“‹</span>
    <span id="copy-text">Copy to Clipboard</span>
  </button>

  <form hx-post="/prompts" hx-target="#save-result">
    <input type="hidden" name="frameworkId" value="<%= frameworkId %>">
    <input type="hidden" name="frameworkName" value="<%= frameworkName %>">
    <input type="hidden" name="promptText" value="<%= promptText.replace(/"/g, '&quot;') %>">
    
    <div class="form-group">
      <label for="title">Title (optional)</label>
      <input type="text" id="title" name="title" placeholder="<%= frameworkName %> Prompt">
    </div>

    <button type="submit" class="btn w-full">Save Prompt</button>
  </form>

  <div id="save-result" class="mt-md"></div>
</div>

<script>
(function() {
  // Wait for clipboard.js to be loaded, then initialize
  setTimeout(function() {
    if (window.initializeCopyButtons) {
      window.initializeCopyButtons();
    } else {
      // Fallback if clipboard.js is not loaded
      const copyBtn = document.getElementById('copy-prompt-btn');
      if (copyBtn && !copyBtn.dataset.listenerAttached) {
        copyBtn.dataset.listenerAttached = 'true';
        
        copyBtn.addEventListener('click', function() {
          const promptText = document.getElementById('prompt-text').textContent;
          const icon = document.getElementById('copy-icon');
          const text = document.getElementById('copy-text');
          
          navigator.clipboard.writeText(promptText).then(() => {
            icon.textContent = 'âœ“';
            text.textContent = 'Copied!';
            copyBtn.style.background = '#27ae60';
            
            setTimeout(() => {
              icon.textContent = 'ðŸ“‹';
              text.textContent = 'Copy to Clipboard';
              copyBtn.style.background = '#3498db';
            }, 2000);
          }).catch(() => {
            const textArea = document.createElement('textarea');
            textArea.value = promptText;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            document.body.appendChild(textArea);
            textArea.select();
            try {
              document.execCommand('copy');
              icon.textContent = 'âœ“';
              text.textContent = 'Copied!';
            } catch (err) {
              text.textContent = 'Copy failed';
            }
            document.body.removeChild(textArea);
          });
        });
      }
    }
  }, 10);
})();
</script>
