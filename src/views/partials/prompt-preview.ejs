<div>
  <div style="background: white; padding: 1rem; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 1rem; max-height: 400px; overflow-y: auto;">
    <pre id="prompt-text" style="white-space: pre-wrap; font-family: inherit; margin: 0;"><%= promptText %></pre>
  </div>
  <button type="button" 
          id="copy-prompt-btn" 
          class="copy-btn"
          style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-bottom: 1rem;">
    <span id="copy-icon">ðŸ“‹</span>
    <span id="copy-text">Copy to Clipboard</span>
  </button>

  <form hx-post="/prompts" hx-target="#save-result">
    <input type="hidden" name="frameworkId" value="<%= frameworkId %>">
    <input type="hidden" name="frameworkName" value="<%= frameworkName %>">
    <input type="hidden" name="promptText" value="<%= promptText.replace(/"/g, '&quot;') %>">
    
    <div class="form-group">
      <label for="title">Title (optional)</label>
      <input type="text" id="title" name="title" placeholder="<%= frameworkName %> Prompt">
    </div>

    <button type="submit" class="btn" style="width: 100%;">Save Prompt</button>
  </form>

  <div id="save-result" style="margin-top: 1rem;"></div>
</div>

<script>
(function() {
  // Wait a tiny bit for htmx to finish inserting the content
  setTimeout(function() {
    const copyBtn = document.getElementById('copy-prompt-btn');
    if (copyBtn && !copyBtn.dataset.listenerAttached) {
      copyBtn.dataset.listenerAttached = 'true';
      
      copyBtn.addEventListener('click', function() {
        const promptText = document.getElementById('prompt-text').textContent;
        const icon = document.getElementById('copy-icon');
        const text = document.getElementById('copy-text');
        
        navigator.clipboard.writeText(promptText).then(() => {
          // Success feedback
          icon.textContent = 'âœ“';
          text.textContent = 'Copied!';
          copyBtn.style.background = '#27ae60';
          
          // Reset after 2 seconds
          setTimeout(() => {
            icon.textContent = 'ðŸ“‹';
            text.textContent = 'Copy to Clipboard';
            copyBtn.style.background = '#3498db';
          }, 2000);
        }).catch(err => {
          // Fallback for older browsers
          const textArea = document.createElement('textarea');
          textArea.value = promptText;
          textArea.style.position = 'fixed';
          textArea.style.left = '-999999px';
          document.body.appendChild(textArea);
          textArea.select();
          try {
            document.execCommand('copy');
            icon.textContent = 'âœ“';
            text.textContent = 'Copied!';
            setTimeout(() => {
              icon.textContent = 'ðŸ“‹';
              text.textContent = 'Copy to Clipboard';
            }, 2000);
          } catch (err) {
            console.error('Failed to copy:', err);
            text.textContent = 'Copy failed';
          }
          document.body.removeChild(textArea);
        });
      });
    }
  }, 10);
})();
</script>
