<% const title = framework.name; %>
<%- include('../layout-wrapper', { body: `
<link rel="stylesheet" href="/css/framework-form.css">
<link rel="stylesheet" href="/css/design-system.css">
<div class="framework-container">
  <div class="admin-header">
    <div class="admin-header-container">
      <div class="admin-header-left">
        <h1>${framework.name}</h1>
        <p>${framework.description}</p>
      </div>
      <div class="admin-header-right">
        <a href="/frameworks" class="btn-secondary">
          <i class="fas fa-arrow-left"></i> Back to Frameworks
        </a>
      </div>
    </div>
  </div>

  ${renderedExamples}

  <div class="form-layout ${framework.templates && framework.templates.length > 0 ? 'has-templates' : ''}">
    <div class="form-section">
      <h3 class="section-title">Fill the Form</h3>
      <form hx-post="/frameworks/${framework.id}/generate" 
            hx-target="#prompt-preview" 
            hx-trigger="submit"
            class="form-container">
        
        ${renderedFields}
        ${renderedCriteria}
        ${renderedAdvanced}

        <div class="form-actions">
          <button type="submit" class="btn btn-primary">Generate Preview</button>
          <button type="button" id="clear-form-btn" class="btn btn-secondary">Clear Form</button>
        </div>
      </form>
    </div>

    <div class="preview-section">
      <h3 class="section-title">Prompt Preview</h3>
      <div id="prompt-preview" class="prompt-preview">
        <p class="preview-placeholder">Fill out the form and click "Generate Preview" to see your prompt.</p>
      </div>
    </div>

    ${renderedTemplates}
  </div>
</div>

${renderedModal}
`, user, subscription }) %>

<script src="/js/framework-form.js"></script>
<% if (framework.examples) { %>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const examples = <%- JSON.stringify(framework.examples) %>;
  FrameworkExamples.init(examples);
});
</script>
<% } %>

<script>
document.addEventListener('DOMContentLoaded', function() {
  <% const criteriaFieldDef = framework.fields.find(f => f.type === 'multi-select-criteria'); %>
  <% if (criteriaFieldDef) { %>
  const criteriaFieldDef = <%- JSON.stringify(criteriaFieldDef) %>;
  FrameworkCriteria.init({
    isPremium: <%= subscription.isPremium %>,
    defaultCriteria: criteriaFieldDef.options || [],
    savedCustomCriteria: <%= JSON.stringify(customCriteria || []) %>,
    defaultValues: criteriaFieldDef.defaultValue || []
  });
  <% } %>
  
  FrameworkAdvancedOptions.init();
  FrameworkModal.init();
});
</script>

<% if (framework.templates && framework.templates.length > 0) { %>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const templates = <%- JSON.stringify(framework.templates) %>;
  FrameworkTemplates.init(templates);
});
</script>
<% } %>
