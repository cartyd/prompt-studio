<% const title = 'Analytics'; %>
<%- include('../layout-wrapper', { body: `
<style>
  .admin-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
  }
  
  .time-filter {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 2rem;
  }
  
  .time-filter a {
    padding: 0.5rem 1rem;
    border: 1px solid #ddd;
    border-radius: 4px;
    text-decoration: none;
    color: var(--color-text);
  }
  
  .time-filter a.active {
    background: var(--color-primary);
    color: white;
    border-color: var(--color-primary);
  }
  
  .analytics-section {
    background: white;
    padding: 1.5rem;
    border-radius: 8px;
    border: 1px solid #e0e0e0;
    margin-bottom: 1.5rem;
  }
  
  .analytics-section h2 {
    margin-bottom: 1rem;
    font-size: 1.25rem;
  }
  
  .data-table {
    width: 100%;
    border-collapse: collapse;
  }
  
  .data-table th {
    text-align: left;
    padding: 0.75rem;
    background: #f5f5f5;
    font-weight: 600;
    border-bottom: 2px solid #e0e0e0;
  }
  
  .data-table td {
    padding: 0.75rem;
    border-bottom: 1px solid #e0e0e0;
  }
  
  .data-table tr:hover {
    background: #fafafa;
  }
</style>

<div class="admin-header">
  <h1>Analytics</h1>
  <a href="/admin/dashboard" class="btn btn-secondary">Back to Dashboard</a>
</div>

<div class="time-filter">
  <a href="/admin/analytics?days=7" class="${days === 7 ? 'active' : ''}">Last 7 Days</a>
  <a href="/admin/analytics?days=30" class="${days === 30 ? 'active' : ''}">Last 30 Days</a>
  <a href="/admin/analytics?days=90" class="${days === 90 ? 'active' : ''}">Last 90 Days</a>
</div>

<!-- Event Stats -->
<div class="analytics-section">
  <h2>Event Type Distribution</h2>
  <table class="data-table">
    <thead>
      <tr>
        <th>Event Type</th>
        <th>Count</th>
      </tr>
    </thead>
    <tbody>
      ${eventStats.map(stat => `
        <tr>
          <td>${stat.eventType}</td>
          <td>${stat._count}</td>
        </tr>
      `).join('')}
    </tbody>
  </table>
</div>

<!-- Daily Events -->
<div class="analytics-section">
  <h2>Daily Event Count</h2>
  <table class="data-table">
    <thead>
      <tr>
        <th>Date</th>
        <th>Events</th>
      </tr>
    </thead>
    <tbody>
      ${dailyEvents.map(stat => `
        <tr>
          <td>${stat.date}</td>
          <td>${stat.count}</td>
        </tr>
      `).join('')}
    </tbody>
  </table>
</div>

<!-- Browser Stats -->
<div class="analytics-section">
  <h2>Browser Distribution</h2>
  <table class="data-table">
    <thead>
      <tr>
        <th>Browser</th>
        <th>Count</th>
      </tr>
    </thead>
    <tbody>
      ${browserStats.map(stat => `
        <tr>
          <td>${stat.browser || 'Unknown'}</td>
          <td>${stat._count}</td>
        </tr>
      `).join('')}
    </tbody>
  </table>
</div>
`, user, subscription }) %>
