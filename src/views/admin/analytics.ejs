<% const title = 'Analytics'; %>
<% const { AdminDataHelpers } = require('../../utils/template-data-helpers'); %>
<%- include('../layout-wrapper', { body: `
<link rel="stylesheet" href="/css/admin.css">

<div class="admin-header">
  <h1>Analytics</h1>
  <a href="/admin/dashboard" class="btn btn-secondary">Back to Dashboard</a>
</div>

<div class="time-filter">
  <a href="/admin/analytics?days=7" class="${days === 7 ? 'active' : ''}">Last 7 Days</a>
  <a href="/admin/analytics?days=30" class="${days === 30 ? 'active' : ''}">Last 30 Days</a>
  <a href="/admin/analytics?days=90" class="${days === 90 ? 'active' : ''}">Last 90 Days</a>
</div>

<!-- Event Stats -->
<div class="analytics-section">
  <h2>Event Type Distribution</h2>
  <table class="data-table">
    <thead>
      <tr>
        <th>Event Type</th>
        <th>Count</th>
      </tr>
    </thead>
    <tbody>
      ${eventStats.map(stat => `
        <tr>
          <td>${stat.eventType}</td>
          <td>${stat._count}</td>
        </tr>
      `).join('')}
    </tbody>
  </table>
</div>

<!-- Daily Events -->
<div class="analytics-section">
  <h2>Daily Event Count</h2>
  <table class="data-table">
    <thead>
      <tr>
        <th>Date</th>
        <th>Events</th>
      </tr>
    </thead>
    <tbody>
      ${dailyEvents.map(stat => `
        <tr>
          <td>${stat.date}</td>
          <td>${stat.count}</td>
        </tr>
      `).join('')}
    </tbody>
  </table>
</div>

<!-- Time of Day Distribution -->
<div class="analytics-section">
  <h2>Time of Day Distribution</h2>
  <table class="data-table">
    <thead>
      <tr>
        <th>Time Period</th>
        <th>Events</th>
      </tr>
    </thead>
    <tbody>
      ${timeOfDayStats.map(stat => `
        <tr>
          <td>${stat.period}</td>
          <td>${stat.count}</td>
        </tr>
      `).join('')}
    </tbody>
  </table>
</div>

<!-- Framework Usage Stats -->
<div class="analytics-section">
  <h2>Framework Usage</h2>
  <table class="data-table">
    <thead>
      <tr>
        <th>Framework</th>
        <th>Views</th>
        <th>Prompts Generated</th>
        <th>Total</th>
      </tr>
    </thead>
    <tbody>
      ${frameworkStats.length > 0 ? frameworkStats.map(stat => `
        <tr>
          <td><strong>${stat.name}</strong></td>
          <td>${stat.views}</td>
          <td>${stat.generates}</td>
          <td><strong>${stat.total}</strong></td>
        </tr>
      `).join('') : '<tr><td colspan="4" class="text-center text-muted">No framework usage data available for this period</td></tr>'}
    </tbody>
  </table>
</div>

<!-- Browser Stats -->
<div class="analytics-section">
  <h2>Browser Distribution</h2>
  <table class="data-table">
    <thead>
      <tr>
        <th>Browser</th>
        <th>Count</th>
      </tr>
    </thead>
    <tbody>
      ${browserStats.map(stat => `
        <tr>
          <td>${stat.browser || 'Unknown'}</td>
          <td>${stat._count}</td>
        </tr>
      `).join('')}
    </tbody>
  </table>
</div>
`, user, subscription }) %>
