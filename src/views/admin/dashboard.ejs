<% const title = 'Admin Dashboard'; %>
<%- include('../layout-wrapper', { body: `
<link rel="stylesheet" href="/css/admin.css">

<!-- Admin Header -->
<div class="admin-header">
  <div class="admin-header-container">
    <h1>Admin Dashboard</h1>
    <div class="quick-actions">
      <a href="/admin/users" class="btn"><i class="fas fa-users" style="margin-right:8px;"></i> Manage Users</a>
      <a href="/admin/analytics" class="btn btn-secondary"><i class="fas fa-chart-line" style="margin-right:8px;"></i> View Analytics</a>
    </div>
  </div>
</div>

<!-- Stats Grid -->
<div class="stats-grid">
  <div class="stat-card">
    <h3>Total Users</h3>
    <div class="value">${stats.totalUsers}</div>
    <div class="subtext">${stats.freeUsers} free, ${stats.premiumUsers} premium</div>
  </div>
  
  <div class="stat-card">
    <h3>Total Prompts</h3>
    <div class="value">${stats.totalPrompts}</div>
  </div>
  
  <div class="stat-card">
    <h3>Total Events</h3>
    <div class="value">${stats.totalEvents}</div>
    <div class="subtext">${stats.recentEvents} in last 24h</div>
  </div>
</div>

<!-- Two Columns: Device & Country Stats -->
<div class="dashboard-columns">

  <!-- Device Distribution -->
  <div class="admin-section">
    <h3>Device Distribution</h3>
    <canvas id="deviceChart"></canvas>
    <table class="data-table" id="device-table">
      <thead>
        <tr><th>Device</th><th class="col-count">Users</th></tr>
      </thead>
      <tbody>
        ${deviceStats.map(stat => `
          <tr data-device="${(stat.deviceType || 'unknown').toLowerCase()}">
            <td>${stat.deviceType || 'Unknown'}</td>
            <td class="col-count">${stat._count}</td>
          </tr>
        `).join('')}
      </tbody>
    </table>
  </div>

  <!-- Top Countries -->
  <div class="admin-section">
    <h3>Top Countries</h3>
    <canvas id="countryChart"></canvas>
    <table class="data-table" id="country-table">
      <thead>
        <tr><th>Country</th><th class="col-count">Events</th></tr>
      </thead>
      <tbody>
        ${countryStats.map(stat => `
          <tr data-country="${stat.countryCode || ''}">
            <td class="country-cell">${stat.country || 'Unknown'}</td>
            <td class="col-count">${stat._count}</td>
          </tr>
        `).join('')}
      </tbody>
    </table>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="/js/admin-dashboard-charts.js"></script>
`, user, subscription }) %>
