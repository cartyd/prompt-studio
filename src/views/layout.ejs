<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="<%= typeof description !== 'undefined' ? description : 'Create structured, effective prompts using proven LLM prompting frameworks including Tree-of-Thought, Chain-of-Thought, and more.' %>">
  <meta name="keywords" content="LLM prompts, AI prompting, prompt engineering, Chain-of-Thought, Tree-of-Thought, prompt frameworks, AI automation">
  <meta name="author" content="Dave Carty">
  <link rel="canonical" href="<%= typeof canonicalUrl !== 'undefined' ? canonicalUrl : 'https://simplicate.ai' %>">
  
  <!-- Open Graph Tags -->
  <meta property="og:title" content="<%= typeof title !== 'undefined' ? title + ' - ' : '' %>Prompt Framework Studio">
  <meta property="og:description" content="<%= typeof description !== 'undefined' ? description : 'Create structured LLM prompts with proven frameworks by Simplicate AI' %>">
  <meta property="og:type" content="website">
  <meta property="og:url" content="<%= typeof canonicalUrl !== 'undefined' ? canonicalUrl : 'https://simplicate.ai' %>">
  <meta property="og:site_name" content="Simplicate AI">
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Prompt Framework Studio">
  <meta name="twitter:description" content="Create structured LLM prompts with proven frameworks">
  
  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  
  <!-- Boxicons -->
  <link href="https://cdn.boxicons.com/3.0.6/fonts/basic/boxicons.min.css" rel="stylesheet">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  
  <!-- Component Utilities -->
  <link rel="stylesheet" href="/css/components.css">
  
  <title><%= typeof title !== 'undefined' ? title : '' %>Prompt Framework Studio</title>
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>
  <style>
    /* ==========  GEIST FONT  ========== */
    @font-face {
      font-family: 'Geist';
      src: url('/fonts/geist/Geist-VariableFont_wght.ttf') format('truetype-variations');
      font-weight: 100 900;
      font-style: normal;
      font-display: swap;
    }
    
    @font-face {
      font-family: 'Geist';
      src: url('/fonts/geist/Geist-Regular.ttf') format('truetype');
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }
    /* ==========  CSS CUSTOM PROPERTIES  ========== */
    :root {
      --color-primary: #3498db;
      --color-primary-dark: #2980b9;
      --color-dark: #2c3e50;
      --color-dark-alt: #1a2733;
      --color-accent: #F26631;
      --color-muted: #95a5a6;
      --color-muted-dark: #7f8c8d;
      --color-success: #27ae60;
      --color-danger: #e74c3c;
      --color-danger-dark: #c0392b;
      --color-warning: #f39c12;
      --color-text: #333;
      --color-text-light: #7f8c8d;
      --color-border: #ddd;
      --color-bg-light: #ecf0f1;
      --color-bg-success: #d5f4e6;
      --color-bg-error: #fadbd8;
      --color-white: #FFFFFF;
      
      --spacing-xs: 0.25rem;
      --spacing-sm: 0.5rem;
      --spacing-md: 1rem;
      --spacing-lg: 1.5rem;
      --spacing-xl: 2rem;
      --spacing-xxl: 3rem;
      
      /* Responsive breakpoints */
      --breakpoint-sm: 640px;
      --breakpoint-md: 768px;
      --breakpoint-lg: 1024px;
      --breakpoint-xl: 1200px;
      
      /* Touch-friendly sizes */
      --touch-target-min: 44px;
      
      /* Component sizes */
      --avatar-size: 36px;
      --logo-height: 60px;
      --dropdown-top-offset: 48px;
      --dropdown-width: 170px;
      --footer-height: 200px;
      --container-max-width: 1200px;
    }

    /* ==========  BASE STYLES  ========== */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: "Geist", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
      line-height: 1.6; 
      color: var(--color-text);
      background-color: #FAFAFA;
      overflow-x: hidden; /* Prevent horizontal scroll */
    }
    .container { 
      max-width: var(--container-max-width); 
      margin: 0 auto; 
      padding: 0 var(--spacing-md);
      width: 100%;
    }
    
    /* ==========  HEADER  ========== */
    header {
      background: linear-gradient(to right, var(--color-dark-alt), var(--color-dark));
      color: var(--color-white);
    }

    .nav-header {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      align-items: center;
      padding: 1rem 1rem;
      gap: 0.5rem;
    }

    /* LEFT: Logo */
    .nav-left { 
      grid-column: 1 / span 4; 
      text-align: left; 
      display: flex;
      align-items: center;
    }

    .nav-left .logo { 
      height: var(--logo-height); 
      object-fit: contain; 
    }

    /* CENTER: Title & Tagline */
    .nav-center { 
      grid-column: 5 / span 4; 
      text-align: center; 
      color: var(--color-white); 
    }

    .nav-center a {
      color: var(--color-white);
      text-decoration: none;
    }

    .nav-center .tagline {
      color: var(--color-muted);
    }

    .nav-center h1 { 
      font-size: 1.5rem; 
      font-weight: 600; 
      margin-bottom: 0rem;
    }

    .nav-center p { 
      font-size: 0.9rem; 
      opacity: 0.85; 
      margin: 0;
    }

    /* RIGHT: Premium button + Avatar */
    .nav-right { 
      grid-column: 9 / span 4; 
      display: flex; 
      justify-content: flex-end; 
      align-items: center; 
      gap: 1rem; 
    }

    /* ==========  BUTTONS  ========== */
    .btn-premium {
      padding: 0.4rem 0.8rem;
      border: 2px solid var(--color-accent);
      color: var(--color-white);
      border-radius: 20px;
      text-decoration: none;
      font-weight: 600;
      font-size: 0.9rem;
      transition: all 0.2s ease;
    }

    .btn-premium:hover { 
      background: var(--color-accent); 
      color: var(--color-white); 
    }

    .btn-sm {
      padding: 0.4rem 0.8rem;
      font-size: 0.9rem;
    }

    /* ==========  AVATAR  ========== */
    .avatar-wrapper { 
      position: relative; 
      cursor: pointer;
      background: none;
      border: none;
      padding: 0;
    }
    
    .avatar {
      width: var(--avatar-size);
      height: var(--avatar-size);
      background: var(--color-primary); 
      color: var(--color-white);
      border-radius: 50%;
      display: flex; justify-content: center; align-items: center;
      font-weight: bold; font-size: 0.95rem;
    }

    /* ==========  DROPDOWN MENU  ========== */
    .dropdown-menu {
      position: absolute;
      top: var(--dropdown-top-offset);
      right: 0;
      width: var(--dropdown-width);
      background: var(--color-white);
      border-radius: 6px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.15);
      padding: var(--spacing-sm) 0;
      z-index: 100;
    }

    .dropdown-menu[hidden] {
      display: none;
    }

    .dropdown-menu hr {
      border: none;
      border-top: 1px solid var(--color-border);
      margin: var(--spacing-sm) 0;
    }

    .dropdown-menu a, .dropdown-menu button {
      display: block;
      width: 100%;
      padding: var(--spacing-sm) var(--spacing-md);
      color: var(--color-text);
      text-decoration: none;
      font-size: 0.95rem;
      background: none;
      border: none;
      text-align: left;
      cursor: pointer;
    }

    .dropdown-menu a:hover, .dropdown-menu button:hover {
      background: #f2f2f2;
    }

    .dropdown-title {
      padding: var(--spacing-sm) var(--spacing-md);
      font-weight: 600;
      color: var(--color-text);
    }

    .dropdown-menu .logout {
      color: var(--color-text);
      font-weight: 600;
    }

    /* RESPONSIVE */
    @media (max-width: 768px) {
      .nav-header { 
        grid-template-columns: 1fr; 
        row-gap: 0.75rem; 
        text-align: center; 
      }
      .nav-left, .nav-center, .nav-right { 
        grid-column: 1 / -1; 
        justify-self: center; 
      }
      .nav-right { justify-content: center; gap: 0.5rem; }
    }

    /* ==========  LAYOUT  ========== */
    main { 
      min-height: calc(100vh - var(--footer-height));
      padding-top: var(--spacing-xl);
      padding-bottom: var(--spacing-xl);
    }
    
    footer { 
      margin-top: var(--spacing-xxl); 
      padding: var(--spacing-xl) 0; 
      background: var(--color-bg-light); 
      text-align: center; 
    }

    footer a {
      color: var(--color-primary);
      text-decoration: none;
    }

    /* ==========  UTILITY CLASSES  ========== */
    .btn { 
      display: inline-block; 
      padding: var(--spacing-sm) var(--spacing-md); 
      background: var(--color-primary); 
      color: var(--color-white); 
      text-decoration: none; 
      border-radius: 4px; 
      border: none; 
      cursor: pointer; 
      font-size: 1rem; 
    }
    
    .btn:hover { background: var(--color-primary-dark); }
    .btn-danger { background: var(--color-danger); }
    .btn-danger:hover { background: var(--color-danger-dark); }
    .btn-secondary { background: var(--color-muted); }
    .btn-secondary:hover { background: var(--color-muted-dark); }
    
    .error { 
      color: var(--color-danger); 
      margin: var(--spacing-md) 0; 
      padding: var(--spacing-sm); 
      background: var(--color-bg-error); 
      border-radius: 4px; 
    }
    
    .success { 
      color: var(--color-success); 
      margin: var(--spacing-md) 0; 
      padding: var(--spacing-sm); 
      background: var(--color-bg-success); 
      border-radius: 4px; 
    }
    
    .badge { 
      display: inline-block; 
      padding: var(--spacing-xs) var(--spacing-sm); 
      background: var(--color-primary); 
      color: var(--color-white); 
      border-radius: 3px; 
      font-size: 0.875rem; 
    }
    
    .badge-premium { background: var(--color-warning); }

    /* Utility spacing classes */
    .ml-sm { margin-left: var(--spacing-sm); }
    .ml-md { margin-left: var(--spacing-md); }
    .mr-sm { margin-right: var(--spacing-sm); }
    .mr-md { margin-right: var(--spacing-md); }
    .mt-sm { margin-top: var(--spacing-sm); }
    .mt-md { margin-top: var(--spacing-md); }
    .mb-sm { margin-bottom: var(--spacing-sm); }
    .mb-md { margin-bottom: var(--spacing-md); }

    /* Utility display classes */
    .flex { display: flex; }
    .flex-col { flex-direction: column; }
    .items-center { align-items: center; }
    .justify-center { justify-content: center; }
    .gap-sm { gap: var(--spacing-sm); }
    .gap-md { gap: var(--spacing-md); }

    /* Utility text classes */
    .text-center { text-align: center; }
    .text-muted { color: var(--color-text-light); }
    .font-bold { font-weight: bold; }
    .font-semibold { font-weight: 600; }

    /* ==========  FORMS  ========== */
    .form-group { margin-bottom: var(--spacing-md); }
    .form-group label { display: block; margin-bottom: var(--spacing-xs); font-weight: 500; }
    .form-group input, .form-group textarea { 
      width: 100%; 
      padding: var(--spacing-sm); 
      border: 1px solid var(--color-border); 
      border-radius: 4px; 
      /* Prevent iOS zoom on focus */
      font-size: max(16px, 1rem);
    }
    .form-group textarea { min-height: 100px; font-family: inherit; }
    
    /* Touch-friendly form controls */
    input[type="checkbox"], input[type="radio"] {
      min-width: 20px;
      min-height: 20px;
      cursor: pointer;
    }
    
    /* ==========  RESPONSIVE UTILITIES  ========== */
    
    /* Responsive Grid */
    .grid { display: grid; gap: var(--spacing-md); }
    .grid-auto-fit { grid-template-columns: repeat(auto-fit, minmax(min(100%, 300px), 1fr)); }
    .grid-cols-1 { grid-template-columns: 1fr; }
    .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
    .grid-gap-sm { gap: var(--spacing-sm); }
    .grid-gap-md { gap: var(--spacing-md); }
    .grid-gap-lg { gap: var(--spacing-lg); }
    .grid-gap-xl { gap: var(--spacing-xl); }
    
    /* Responsive Flex */
    .flex-wrap { flex-wrap: wrap; }
    .flex-nowrap { flex-wrap: nowrap; }
    
    /* Responsive visibility */
    .hide-mobile { display: none; }
    .show-mobile { display: block; }
    
    /* Responsive spacing */
    .p-sm { padding: var(--spacing-sm); }
    .p-md { padding: var(--spacing-md); }
    .p-lg { padding: var(--spacing-lg); }
    .p-xl { padding: var(--spacing-xl); }
    
    /* Width utilities */
    .w-full { width: 100%; }
    .max-w-full { max-width: 100%; }
    
    /* Touch-friendly buttons */
    .btn-touch {
      min-height: var(--touch-target-min);
      min-width: var(--touch-target-min);
      padding: var(--spacing-sm) var(--spacing-md);
    }
    
    /* Tablet and up (768px+) */
    @media (min-width: 768px) {
      .hide-mobile { display: block; }
      .show-mobile { display: none; }
      
      .grid-md-2 { grid-template-columns: repeat(2, 1fr); }
      .grid-md-3 { grid-template-columns: repeat(3, 1fr); }
      
      .container { padding: 0 var(--spacing-xl); }
    }
    
    /* Desktop and up (1024px+) */
    @media (min-width: 1024px) {
      .grid-lg-2 { grid-template-columns: repeat(2, 1fr); }
      .grid-lg-3 { grid-template-columns: repeat(3, 1fr); }
      .grid-lg-auto-fit { grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); }
    }
  </style>
</head>
<body>
  <%
    // Helper variables to reduce repeated logic
    const isAuthenticated = typeof user !== 'undefined' && user;
    const isPremiumUser = isAuthenticated && subscription && subscription.isPremium;
    const showPremiumUpgrade = isAuthenticated && !isPremiumUser;
    const userInitial = isAuthenticated ? user.name.charAt(0).toUpperCase() : '';
  %>
  
  <header>
    <div class="container">
      <nav class="nav-header">
        
        <!-- LEFT: Logo -->
        <div class="nav-left">
          <a href="/">
            <img src="/simplicate.png" class="logo" alt="Simplicate AI Logo">
          </a>
        </div>

        <!-- CENTER: Title & Tagline -->
        <div class="nav-center">
          <h1><a href="/">Prompt Framework Studio</a></h1>
          <p class="tagline"><em>Nothing But Prompt</em></p>
        </div>

        <!-- RIGHT: Premium Button + Avatar / Login -->
        <div class="nav-right">
          <% if (isAuthenticated) { %>
            <!-- Premium Button (if not premium) -->
            <% if (showPremiumUpgrade) { %>
              <a href="/premium" class="btn-premium">Upgrade to Premium</a>
            <% } %>

            <!-- Avatar with Dropdown -->
            <button class="avatar-wrapper" 
                    id="avatar-wrapper" 
                    type="button"
                    aria-label="User menu"
                    aria-haspopup="true"
                    aria-expanded="false">
              <div class="avatar"><%= userInitial %></div>
            </button>
              
            <!-- Dropdown Menu -->
            <div class="dropdown-menu" id="dropdown-menu" role="menu" hidden>
                <div class="dropdown-title">
                  <%= user.name %>
                  <% if (isPremiumUser) { %>
                    <span class="badge badge-premium ml-sm">Premium</span>
                  <% } %>
                </div>
                <hr>
                <% if (user.isAdmin) { %>
                  <a href="/admin/dashboard" role="menuitem"><strong>Admin Dashboard</strong></a>
                  <a href="/admin/users" role="menuitem">Manage Users</a>
                  <a href="/admin/analytics" role="menuitem">Analytics</a>
                  <hr>
                <% } %>
                <a href="/frameworks" role="menuitem">Frameworks</a>
                <a href="/prompts" role="menuitem">My Prompts</a>
                <% if (showPremiumUpgrade) { %>
                  <a href="/premium" role="menuitem">Upgrade to Premium</a>
                <% } %>
                <hr>
                <a href="/account/settings" role="menuitem">Account Settings</a>
                <a href="/about" role="menuitem">About</a>
                <hr>
                <form action="/auth/logout" method="POST">
                  <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                  <button type="submit" class="logout" role="menuitem">Logout</button>
                </form>
            </div>
          <% } else { %>
            <!-- Login/Register for non-authenticated users -->
            <a href="/auth/login" class="btn btn-sm">Login</a>
            <a href="/auth/register" class="btn btn-sm">Register</a>
          <% } %>
        </div>

      </nav>
    </div>
  </header>

  <main class="container">
    <%- body %>
  </main>

  <footer>
    <div class="container">
      <p>
        &copy; 2026 Prompt Framework Studio by <a href="https://simplicate.ai">Simplicate AI</a>. Created by Dave Carty.
        <br>
        <a href="/legal/privacy">Privacy Policy</a> | <a href="/legal/terms">Terms of Service</a>
      </p>
    </div>
  </footer>

  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Prompt Framework Studio",
    "description": "Create structured, effective prompts using proven LLM prompting frameworks",
    "url": "https://simplicate.ai",
    "author": {
      "@type": "Person",
      "name": "Dave Carty"
    },
    "publisher": {
      "@type": "Organization",
      "name": "Simplicate AI",
      "url": "https://simplicate.ai"
    },
    "applicationCategory": "DeveloperApplication",
    "operatingSystem": "Web Browser",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    }
  }
  </script>

  <% if (isAuthenticated) { %>
  <script>
    // ==========  USER DROPDOWN MENU  ==========
    (function() {
      const avatarWrapper = document.getElementById('avatar-wrapper');
      const dropdownMenu = document.getElementById('dropdown-menu');

      if (!avatarWrapper || !dropdownMenu) return;

      // Toggle dropdown on avatar click
      avatarWrapper.addEventListener('click', function(e) {
        e.stopPropagation();
        const isExpanded = this.getAttribute('aria-expanded') === 'true';
        
        dropdownMenu.toggleAttribute('hidden');
        this.setAttribute('aria-expanded', !isExpanded);
      });

      // Close dropdown when clicking outside
      document.body.addEventListener('click', function() {
        if (!dropdownMenu.hasAttribute('hidden')) {
          dropdownMenu.setAttribute('hidden', '');
          avatarWrapper.setAttribute('aria-expanded', 'false');
        }
      });

      // Close dropdown on Escape key and return focus
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && !dropdownMenu.hasAttribute('hidden')) {
          dropdownMenu.setAttribute('hidden', '');
          avatarWrapper.setAttribute('aria-expanded', 'false');
          avatarWrapper.focus();
        }
      });
    })();
  </script>
  <% } %>
</body>
</html>
